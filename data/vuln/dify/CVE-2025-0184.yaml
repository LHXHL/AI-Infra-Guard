info:
  name: dify
  cve: CVE-2025-0184
  summary: Dify的WordExtractor中存在服务器端请求伪造(SSRF)漏洞
  details: |
    在Dify的“创建知识”部分上传DOCX文件时，如果DOCX文件中存在外部关系，则会请求reltype值作为URL。请求使用'requests'模块发送，而不是用于防止SSRF漏洞的'ssrf_proxy'，从而导致SSRF漏洞。此外，攻击者可以通过工作流中的HTTP请求块访问SSRF结果。
    该漏洞的详细情况是，在处理图像时，如果目标引用包含'image'字符串且关系为'external'，则会将reltype值作为URL请求。此时，请求使用'requests'模块发送，而不是使用为防止Dify中的SSRF漏洞而实现的'ssrf_proxy'，导致SSRF漏洞。
    尽管攻击者不能直接访问文件内容（SSRF结果），但由于错误处理不当，内容仍保存在'image_files/'目录中，且文件UUID存储在'upload_files'表中。因此，知道文件UUID的攻击者可以使用基于文件UUID读取本地文件的函数来访问结果。
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:N/A:N
  severity: MEDIUM
  security_advise: 升级到dify >= 0.11.0版本以解决此问题。
rule: version < "0.11.0"
references:
 - https://github.com/langgenius/dify/compare/main...fix/docx-extract-image-ssrf
 - https://nvd.nist.gov/vuln/detail/CVE-2025-0184
 - https://drive.google.com/file/d/1EIHnqOVSlEQN9_vP4CxYqA-77xOPKa1p/view?usp=sharing