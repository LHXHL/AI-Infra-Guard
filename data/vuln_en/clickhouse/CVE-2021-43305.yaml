info:
  name: clickhouse-lz4-heap-buffer-overflow
  cve: CVE-2021-43305
  summary: Heap buffer overflow in Clickhouse's LZ4 compression codec
  details: |
    Heap buffer overflow in Clickhouse's LZ4 compression codec when parsing a malicious query. There is no verification that the copy operations in the LZ4::decompressImpl loop and especially the arbitrary copy operation wildCopy<copy_amount>(op, ip, copy_end), don’t exceed the destination buffer’s limits. This issue is very similar to CVE-2021-43304, but the vulnerable copy operation is in a different wildCopy call.
  cvss: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
  severity: HIGH
  security_advise: |
    1. Upgrade to the latest version of Clickhouse where this vulnerability is fixed.
    2. Review and update your Clickhouse configurations to ensure secure query handling.
    3. Monitor for any unusual activity that could indicate exploitation of this vulnerability.
rule: version < "21.3.4.1" # Assuming this is the version where the fix was released
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-43305
  - https://jfrog.com/blog/7-rce-and-dos-vulnerabilities-found-in-clickhouse-dbms
  - https://lists.debian.org/debian-lts-announce/2022/11/msg00002.html