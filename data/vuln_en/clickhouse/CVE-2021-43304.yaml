info:
  name: clickhouse-lz4-heap-buffer-overflow
  cve: CVE-2021-43304
  summary: Heap buffer overflow in Clickhouse's LZ4 compression codec
  details: |
    The vulnerability arises from a heap buffer overflow in Clickhouse's LZ4 compression codec when parsing a malicious query. There is no verification that the copy operations in the LZ4::decompressImpl loop, particularly the arbitrary copy operation wildCopy<copy_amount>(op, ip, copy_end), do not exceed the destination bufferâ€™s limits.
  cvss: CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H
  severity: HIGH
  security_advise: |
    1. Upgrade to the latest version of Clickhouse where this vulnerability has been fixed.
    2. Implement input validation to ensure that queries do not contain malicious data.
    3. Monitor for any unusual activity that could indicate an exploitation attempt.
rule: version < "21.3.4.1" # Assuming this is the version where the fix was released
references:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-43304
  - https://jfrog.com/blog/7-rce-and-dos-vulnerabilities-found-in-clickhouse-dbms
  - https://lists.debian.org/debian-lts-announce/2022/11/msg00002.html