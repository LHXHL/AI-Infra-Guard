info:
  name: pyload-ng-rce-vulnerability
  cve: CVE-2024-39205
  summary: pyload-ng vulnerable to RCE with js2py sandbox escape
  details: |
    Any pyload-ng running under python3.11 or below are vulnerable to Remote Code Execution (RCE). Attacker can send a request containing any shell command and the victim server will execute it immediately. This vulnerability arises from a sandbox escape in js2py, which is exploited by the `/flash/addcrypted2` API endpoint of pyload-ng.
    Although this endpoint is designed to only accept localhost connection, it can be bypassed using HTTP Header, thus accessing this API and achieving RCE.
    The PoC is provided as `poc.py` and demonstrates how an attacker can execute arbitrary shell commands on the victim's server.
  cvss: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. Upgrade to pyload-ng version greater than 0.5.0b3.dev85 or apply the latest security patches.
    2. Consider upgrading to Python 3.12 or above, as pyload-ng does not use js2py in these versions, mitigating the vulnerability.
    3. Review and restrict access to the `/flash/addcrypted2` API endpoint to prevent unauthorized access.
rule: version <= "0.5.0b3.dev85" && python_version <= "3.11"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-r9pp-r4xf-597r
  - https://nvd.nist.gov/vuln/detail/CVE-2024-39205
  - https://github.com/Marven11/CVE-2024-28397-js2py-Sandbox-Escape
  - https://github.com/advisories/GHSA-h95x-26f3-88hr
  - https://github.com/pyload/pyload