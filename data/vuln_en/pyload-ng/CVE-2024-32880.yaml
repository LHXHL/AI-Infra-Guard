info:
  name: pyload-ng-rce-vulnerability
  cve: CVE-2024-32880
  summary: pyLoad allows upload to arbitrary folder leading to Remote Code Execution (RCE)
  details: |
    An authenticated user can change the download folder and upload a crafted template to the specified folder, leading to remote code execution. The vulnerability affects all versions, with earlier versions having different trigger conditions.
    
    Example version: 0.5
    File: src/pyload/webui/app/blueprints/app_blueprint.py
    
    The `render_template` function can be exploited like SSTI when rendering a controlled file. By changing the download folder to the template path and uploading a crafted template file, an attacker can execute arbitrary code.
    
    PoC:
    1. Login into the admin page.
    2. Visit the info page to get the path of pyload installation folder.
    3. Change the download folder to `PYLOAD_INSTALL_DIR/webui/app/templates/`.
    4. Upload a crafted template file through `/json/add_package` with the filename `341.html` containing:
       ```html
       {{x.__init__.__globals__['__builtins__']['eval']("__import__('os').popen('whoami').read()")}}
       ```
    5. Visit `http://TARGET/render/tmp_341.html` to trigger the RCE.
  cvss: CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H
  severity: CRITICAL
  security_advise: |
    1. Immediately upgrade to pyload-ng version 0.5.1 or later.
    2. Review and restrict file upload functionalities to prevent unauthorized template uploads.
    3. Implement strict validation for download folder changes.
rule: version < "0.5.1"
references:
  - https://github.com/pyload/pyload/security/advisories/GHSA-3f7w-p8vr-4v5f
  - https://nvd.nist.gov/vuln/detail/CVE-2024-32880
  - https://github.com/pyload/pyload